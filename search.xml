<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>adb</title>
      <link href="/2022/01/26/adb/"/>
      <url>/2022/01/26/adb/</url>
      
        <content type="html"><![CDATA[<h2 id="ADB总结"><a href="#ADB总结" class="headerlink" title="ADB总结"></a>ADB总结</h2><p>Android 调试桥 (adb) <a href="https://developer.android.google.cn/studio/command-line/adb?hl=zh_cn#shellcommands">谷歌文档介绍链接</a>是一种功能多样的命令行工具，可让您与设备进行通信。它是一种客户端服务端程序，包含下列三个组件：客户端、守护程序、服务器。</p><h4 id="1-ADB工作原理"><a href="#1-ADB工作原理" class="headerlink" title="1.ADB工作原理"></a>1.ADB工作原理</h4><p>服务器在启动后会与本地 TCP 端口 <strong>5037</strong> 绑定，并监听 adb 客户端发出的命令 - 所有 adb 客户端均通过端口 5037 与 adb 服务器通信。然后，服务器会与所有正在运行的设备建立连接。它通过扫描 5555 到 5585 之间（该范围供前 16 个模拟器使用）的奇数号端口查找模拟器。服务器一旦发现 adb 守护程序 (adbd)，便会与相应的端口建立连接。</p><blockquote><p>PC 端的 adb server 与手机端的守护进程 adbd 建立连接，然后 PC 端的 adb client 通过 adb server 转发命令，adbd 接收命令后解析运行。</p></blockquote><h4 id="2-基础ADB命令"><a href="#2-基础ADB命令" class="headerlink" title="2.基础ADB命令"></a>2.基础ADB命令</h4><ul><li><p>连接到ADB</p><blockquote><p>可以分为有线连接以及无线连接（Android11以上）</p></blockquote></li><li><p>查看当前设备</p><blockquote><p>adb devices</p></blockquote></li><li><p>指定设备</p><blockquote><p>adb -d（设备） -e（模拟器） -s（序列号）</p></blockquote></li><li><p>启动/停止</p><blockquote><p>adb start-server</p><p>adb kill-server</p></blockquote></li><li><p>查看adb版本</p><blockquote><p>adb version</p></blockquote></li><li><p>以root权限运行adbd</p><blockquote><p>adb root</p></blockquote></li><li><p>查看详细的adb命令</p><blockquote><p>adb –help</p></blockquote></li><li><p>安装apk</p><blockquote><p>adb install [-lrtsdg] <path_to_apk></path_to_apk></p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-l</td><td>将应用安装到保护目录 /mnt/asec</td></tr><tr><td>-r</td><td>允许覆盖安装</td></tr><tr><td>-t</td><td>允许安装 AndroidManifest.xml 里 application 指定 <code>android:testOnly="true"</code> 的应用</td></tr><tr><td>-s</td><td>将应用安装到 sdcard</td></tr><tr><td>-d</td><td>允许降级覆盖安装</td></tr><tr><td>-g</td><td>授予所有运行时权限</td></tr></tbody></table><blockquote><p>安装时出错：</p><table><thead><tr><th>输出</th><th>含义</th><th>解决办法</th></tr></thead><tbody><tr><td>INSTALL_FAILED_ALREADY_EXISTS</td><td>应用已经存在，或卸载了但没卸载干净</td><td><code>adb install</code> 时使用 <code>-r</code> 参数，或者先 <code>adb uninstall &lt;packagename&gt;</code> 再安装</td></tr><tr><td>INSTALL_FAILED_INVALID_APK</td><td>无效的 APK 文件</td><td></td></tr><tr><td>INSTALL_FAILED_INVALID_URI</td><td>无效的 APK 文件名</td><td>确保 APK 文件名里无中文</td></tr><tr><td>INSTALL_FAILED_INSUFFICIENT_STORAGE</td><td>空间不足</td><td>清理空间</td></tr><tr><td>INSTALL_FAILED_DUPLICATE_PACKAGE</td><td>已经存在同名程序</td><td></td></tr><tr><td>INSTALL_FAILED_NO_SHARED_USER</td><td>请求的共享用户不存在</td><td></td></tr><tr><td>INSTALL_FAILED_UPDATE_INCOMPATIBLE</td><td>以前安装过同名应用，但卸载时数据没有移除；或者已安装该应用，但签名不一致</td><td>先 <code>adb uninstall &lt;packagename&gt;</code> 再安装</td></tr><tr><td>INSTALL_FAILED_SHARED_USER_INCOMPATIBLE</td><td>请求的共享用户存在但签名不一致</td><td></td></tr><tr><td>INSTALL_FAILED_MISSING_SHARED_LIBRARY</td><td>安装包使用了设备上不可用的共享库</td><td></td></tr><tr><td>INSTALL_FAILED_REPLACE_COULDNT_DELETE</td><td>替换时无法删除</td><td></td></tr><tr><td>INSTALL_FAILED_DEXOPT</td><td>dex 优化验证失败或空间不足</td><td></td></tr><tr><td>INSTALL_FAILED_OLDER_SDK</td><td>设备系统版本低于应用要求</td><td></td></tr><tr><td>INSTALL_FAILED_CONFLICTING_PROVIDER</td><td>设备里已经存在与应用里同名的 content provider</td><td></td></tr><tr><td>INSTALL_FAILED_NEWER_SDK</td><td>设备系统版本高于应用要求</td><td></td></tr><tr><td>INSTALL_FAILED_TEST_ONLY</td><td>应用是 test-only 的，但安装时没有指定 <code>-t</code> 参数</td><td></td></tr><tr><td>INSTALL_FAILED_CPU_ABI_INCOMPATIBLE</td><td>包含不兼容设备 CPU 应用程序二进制接口的 native code</td><td></td></tr><tr><td>INSTALL_FAILED_MISSING_FEATURE</td><td>应用使用了设备不可用的功能</td><td></td></tr><tr><td>INSTALL_FAILED_CONTAINER_ERROR</td><td>1. sdcard 访问失败; 2. 应用签名与 ROM 签名一致，被当作内置应用。</td><td>1. 确认 sdcard 可用，或者安装到内置存储; 2. 打包时不与 ROM 使用相同签名。</td></tr><tr><td>INSTALL_FAILED_INVALID_INSTALL_LOCATION</td><td>1. 不能安装到指定位置; 2. 应用签名与 ROM 签名一致，被当作内置应用。</td><td>1. 切换安装位置，添加或删除 <code>-s</code> 参数; 2. 打包时不与 ROM 使用相同签名。</td></tr><tr><td>INSTALL_FAILED_MEDIA_UNAVAILABLE</td><td>安装位置不可用</td><td>一般为 sdcard，确认 sdcard 可用或安装到内置存储</td></tr><tr><td>INSTALL_FAILED_VERIFICATION_TIMEOUT</td><td>验证安装包超时</td><td></td></tr><tr><td>INSTALL_FAILED_VERIFICATION_FAILURE</td><td>验证安装包失败</td><td></td></tr><tr><td>INSTALL_FAILED_PACKAGE_CHANGED</td><td>应用与调用程序期望的不一致</td><td></td></tr><tr><td>INSTALL_FAILED_UID_CHANGED</td><td>以前安装过该应用，与本次分配的 UID 不一致</td><td>清除以前安装过的残留文件</td></tr><tr><td>INSTALL_FAILED_VERSION_DOWNGRADE</td><td>已经安装了该应用更高版本</td><td>使用 <code>-d</code> 参数</td></tr><tr><td>INSTALL_FAILED_PERMISSION_MODEL_DOWNGRADE</td><td>已安装 target SDK 支持运行时权限的同名应用，要安装的版本不支持运行时权限</td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_NOT_APK</td><td>指定路径不是文件，或不是以 <code>.apk</code> 结尾</td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_BAD_MANIFEST</td><td>无法解析的 AndroidManifest.xml 文件</td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION</td><td>解析器遇到异常</td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_NO_CERTIFICATES</td><td>安装包没有签名</td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_INCONSISTENT_CERTIFICATES</td><td>已安装该应用，且签名与 APK 文件不一致</td><td>先卸载设备上的该应用，再安装</td></tr><tr><td>INSTALL_PARSE_FAILED_CERTIFICATE_ENCODING</td><td>解析 APK 文件时遇到 <code>CertificateEncodingException</code></td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_BAD_PACKAGE_NAME</td><td>manifest 文件里没有或者使用了无效的包名</td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_BAD_SHARED_USER_ID</td><td>manifest 文件里指定了无效的共享用户 ID</td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_MANIFEST_MALFORMED</td><td>解析 manifest 文件时遇到结构性错误</td><td></td></tr><tr><td>INSTALL_PARSE_FAILED_MANIFEST_EMPTY</td><td>在 manifest 文件里找不到找可操作标签（instrumentation 或 application）</td><td></td></tr><tr><td>INSTALL_FAILED_INTERNAL_ERROR</td><td>因系统问题安装失败</td><td></td></tr><tr><td>INSTALL_FAILED_USER_RESTRICTED</td><td>用户被限制安装应用</td><td></td></tr><tr><td>INSTALL_FAILED_DUPLICATE_PERMISSION</td><td>应用尝试定义一个已经存在的权限名称</td><td></td></tr><tr><td>INSTALL_FAILED_NO_MATCHING_ABIS</td><td>应用包含设备的应用程序二进制接口不支持的 native code</td><td></td></tr><tr><td>INSTALL_CANCELED_BY_USER</td><td>应用安装需要在设备上确认，但未操作设备或点了取消</td><td>在设备上同意安装</td></tr><tr><td>INSTALL_FAILED_ACWF_INCOMPATIBLE</td><td>应用程序与设备不兼容</td><td></td></tr><tr><td>does not contain AndroidManifest.xml</td><td>无效的 APK 文件</td><td></td></tr><tr><td>is not a valid zip file</td><td>无效的 APK 文件</td><td></td></tr><tr><td>Offline</td><td>设备未连接成功</td><td>先将设备与 adb 连接成功</td></tr><tr><td>unauthorized</td><td>设备未授权允许调试</td><td></td></tr><tr><td>error: device not found</td><td>没有连接成功的设备</td><td>先将设备与 adb 连接成功</td></tr><tr><td>protocol failure</td><td>设备已断开连接</td><td>先将设备与 adb 连接成功</td></tr><tr><td>Unknown option: -s</td><td>Android 2.2 以下不支持安装到 sdcard</td><td>不使用 <code>-s</code> 参数</td></tr><tr><td>No space left on device</td><td>空间不足</td><td>清理空间</td></tr><tr><td>Permission denied … sdcard …</td><td>sdcard 不可用</td><td></td></tr><tr><td>signatures do not match the previously installed version; ignoring!</td><td>已安装该应用且签名不一致</td><td></td></tr></tbody></table></blockquote><p>安装的内部原理：</p><ol><li>push apk 文件到 /data/local/tmp。</li><li>调用 pm install 安装。</li><li>删除 /data/local/tmp 下的对应 apk 文件。</li></ol></blockquote></li><li><p>卸载apk</p><blockquote><p>adb uninstall [-k] <packagename>  -k 参数可选，表示卸载应用但保留数据和缓存目录。</packagename></p></blockquote></li><li><p>文件管理</p><ul><li><p>复制设备里的文件到电脑</p><blockquote><p>adb pull &lt;设备里的文件路径&gt; [电脑上的目录]</p></blockquote></li><li><p>复制电脑里的文件到设备</p><blockquote><p>adb push &lt;电脑上的文件路径&gt; &lt;设备里的目录&gt;</p></blockquote></li></ul></li><li><p>查看日志</p><p>Android 系统的日志分为两部分，底层的 Linux 内核日志输出到 /proc/kmsg，Android 的日志输出到 /dev/log。</p><ul><li><p>Android日志</p><blockquote><p>[adb] logcat [<option>] … [<filter-spec>] …</filter-spec></option></p><p>（1）按级别过滤日志——Android 的日志分为如下几个优先级（priority）：</p><ul><li>V —— Verbose（最低，输出得最多）</li><li>D —— Debug I —— Info</li><li>W —— Warning</li><li>E —— Error</li><li>F—— Fatal</li><li>S —— Silent（最高，啥也不输出）</li></ul><p>例：adb logcat *:W 会将 Warning、Error、Fatal 和 Silent 日志输出。</p><p>（2）按 tag 和级别过滤日志</p><p>（3）清空日志</p><blockquote><p>adb logcat -c</p></blockquote></blockquote></li><li><p>内核日志</p><blockquote><p>adb shell dmesg</p></blockquote></li></ul></li></ul><h4 id="3-ADB-SHELL"><a href="#3-ADB-SHELL" class="headerlink" title="3.ADB SHELL"></a>3.ADB SHELL</h4><p>Android 提供了大多数常见的 Unix 命令行工具。</p><blockquote><p>进入adb shell后，可以使用大多数unix命令 例如：adb shell ls /system/bin</p></blockquote><ol><li><p>应用管理pm</p><ul><li>查看应用列表</li></ul><blockquote><p>adb shell pm list packages   可以加一些参数进行过滤查看不同的列表</p><table><thead><tr><th>参数</th><th>显示列表</th></tr></thead><tbody><tr><td>无</td><td>所有应用</td></tr><tr><td>-f</td><td>显示应用关联的 apk 文件</td></tr><tr><td>-d</td><td>只显示 disabled 的应用</td></tr><tr><td>-e</td><td>只显示 enabled 的应用</td></tr><tr><td>-s</td><td>只显示系统应用</td></tr><tr><td>-3</td><td>只显示第三方应用</td></tr><tr><td>-i</td><td>显示应用的 installer</td></tr><tr><td>-u</td><td>包含已卸载应用</td></tr><tr><td><code>&lt;FILTER&gt;</code></td><td>包名包含 <code>&lt;FILTER&gt;</code> 字符串</td></tr></tbody></table></blockquote><ul><li><p>清除应用数据与缓存</p><blockquote><p>adb shell pm clear <packagename>  </packagename></p></blockquote></li><li><p>禁用应用和启动</p><blockquote><p>adb shell pm disable <packagename></packagename></p><p>adb shell pm enable  <packagename></packagename></p></blockquote></li><li><p>授予撤销应用权限</p><blockquote><p>adb shell pm grant <packagename> <package_permission></package_permission></packagename></p><p>adb shell pm revoke <packagename> <package_permission></package_permission></packagename></p></blockquote></li></ul></li><li><p>Activity管理am</p><ul><li>am命令总览:</li></ul><blockquote><table><thead><tr><th>command</th><th>用途</th></tr></thead><tbody><tr><td><code>start [options] &lt;INTENT&gt;</code></td><td>启动 <code>&lt;INTENT&gt;</code> 指定的 Activity</td></tr><tr><td><code>startservice [options] &lt;INTENT&gt;</code></td><td>启动 <code>&lt;INTENT&gt;</code> 指定的 Service</td></tr><tr><td><code>broadcast [options] &lt;INTENT&gt;</code></td><td>发送 <code>&lt;INTENT&gt;</code> 指定的广播</td></tr><tr><td><code>force-stop &lt;packagename&gt;</code></td><td>停止 <code>&lt;packagename&gt;</code> 相关的进程</td></tr></tbody></table><p>intent可以采用action、category、component：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>-a &lt;ACTION&gt;</code></td><td>指定 action，比如 <code>android.intent.action.VIEW</code></td></tr><tr><td><code>-c &lt;CATEGORY&gt;</code></td><td>指定 category，比如 <code>android.intent.category.APP_CONTACTS</code></td></tr><tr><td><code>-n &lt;COMPONENT&gt;</code></td><td>指定完整 component 名，用于明确指定启动哪个 Activity，如 <code>com.example.app/.ExampleActivity</code></td></tr></tbody></table><p><code>&lt;INTENT&gt;</code> 可以带数据：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td><code>--esn &lt;EXTRA_KEY&gt;</code></td><td>null 值（只有 key 名）</td></tr><tr><td>`-e</td><td>–es <extra_key> <extra_string_value>`</extra_string_value></extra_key></td></tr><tr><td><code>--ez &lt;EXTRA_KEY&gt; &lt;EXTRA_BOOLEAN_VALUE&gt;</code></td><td>boolean 值</td></tr><tr><td><code>--ei &lt;EXTRA_KEY&gt; &lt;EXTRA_INT_VALUE&gt;</code></td><td>integer 值</td></tr><tr><td><code>--el &lt;EXTRA_KEY&gt; &lt;EXTRA_LONG_VALUE&gt;</code></td><td>long 值</td></tr><tr><td><code>--ef &lt;EXTRA_KEY&gt; &lt;EXTRA_FLOAT_VALUE&gt;</code></td><td>float 值</td></tr><tr><td><code>--eu &lt;EXTRA_KEY&gt; &lt;EXTRA_URI_VALUE&gt;</code></td><td>URI</td></tr><tr><td><code>--ecn &lt;EXTRA_KEY&gt; &lt;EXTRA_COMPONENT_NAME_VALUE&gt;</code></td><td>component name</td></tr><tr><td><code>--eia &lt;EXTRA_KEY&gt; &lt;EXTRA_INT_VALUE&gt;[,&lt;EXTRA_INT_VALUE...]</code></td><td>integer 数组</td></tr><tr><td><code>--ela &lt;EXTRA_KEY&gt; &lt;EXTRA_LONG_VALUE&gt;[,&lt;EXTRA_LONG_VALUE...]</code></td><td>long 数组</td></tr></tbody></table></blockquote><ul><li><p>举例：</p><blockquote><p>调用activity</p><blockquote><p>adb shell am start -n org.mazhuang.boottimemeasure/.MainActivity –es “toast” “hello, world”      表示调起 org.mazhuang.boottimemeasure/.MainActivity 并传给它 string 数据键值对 toast - hello, world。</p></blockquote><p>调用service</p><blockquote><p>adb shell am startservice -n com.tencent.mm/.plugin.accountsync.model.AccountAuthenticatorService</p></blockquote><p>发送广播</p><blockquote><p>adb shell am broadcast -a android.intent.action.BOOT_COMPLETED -n org.mazhuang.boottimemeasure/.BootCompletedReceiver</p></blockquote></blockquote></li><li><p>强制停止应用</p><blockquote><p>adb shell am force-stop <packagename></packagename></p></blockquote></li><li><p>禁用/启动应用</p></li></ul></li><li><p>dumpsys</p><ul><li><p>看前台activity</p><blockquote><p>adb shell dumpsys activity activities | grep mFocusedActivity</p></blockquote></li><li><p>查看正在运行的service</p><blockquote><p>adb shell dumpsys activity services [<packagename>]</packagename></p><p><code>&lt;packagename&gt;</code> 参数不是必须的，指定 <code>&lt;packagename&gt;</code> 表示查看与某个包名相关的 Services，不指定表示查看所有 Services。</p></blockquote></li><li><p>查看应用详细信息</p><blockquote><p>adb shell dumpsys package <packagename></packagename></p></blockquote></li><li><p>电池状况</p><blockquote><p>adb shell dumpsys battery</p></blockquote></li></ul></li><li><p>模拟按键输入</p><ul><li>adb shell input keyevent</li><li>adb shell input tap（点击）/swipe（滑动，可用于滑动解锁）/text（输入文字）</li></ul><blockquote><table><thead><tr><th>keycode</th><th>含义</th></tr></thead><tbody><tr><td>3</td><td>HOME 键</td></tr><tr><td>4</td><td>返回键</td></tr><tr><td>5</td><td>打开拨号应用</td></tr><tr><td>6</td><td>挂断电话</td></tr><tr><td>24</td><td>增加音量</td></tr><tr><td>25</td><td>降低音量</td></tr><tr><td>26</td><td>电源键</td></tr><tr><td>27</td><td>拍照（需要在相机应用里）</td></tr><tr><td>64</td><td>打开浏览器</td></tr><tr><td>82</td><td>菜单键</td></tr><tr><td>85</td><td>播放/暂停</td></tr><tr><td>86</td><td>停止播放</td></tr><tr><td>87</td><td>播放下一首</td></tr><tr><td>88</td><td>播放上一首</td></tr><tr><td>122</td><td>移动光标到行首或列表顶部</td></tr><tr><td>123</td><td>移动光标到行末或列表底部</td></tr><tr><td>126</td><td>恢复播放</td></tr><tr><td>127</td><td>暂停播放</td></tr><tr><td>164</td><td>静音</td></tr><tr><td>176</td><td>打开系统设置</td></tr><tr><td>187</td><td>切换应用</td></tr><tr><td>207</td><td>打开联系人</td></tr><tr><td>208</td><td>打开日历</td></tr><tr><td>209</td><td>打开音乐</td></tr><tr><td>210</td><td>打开计算器</td></tr><tr><td>220</td><td>降低屏幕亮度</td></tr><tr><td>221</td><td>提高屏幕亮度</td></tr><tr><td>223</td><td>系统休眠</td></tr><tr><td>224</td><td>点亮屏幕</td></tr><tr><td>231</td><td>打开语音助手</td></tr><tr><td>276</td><td>如果没有 wakelock 则让系统休眠</td></tr></tbody></table></blockquote></li><li><p>查看设备信息</p><blockquote><p>adb shell getprop ro.product.model</p></blockquote></li></ol><h4 id="4-其他命令"><a href="#4-其他命令" class="headerlink" title="4.其他命令"></a>4.其他命令</h4><ul><li><p>屏幕截图</p><blockquote><p>adb exec-out screencap -p &gt; sc.png</p></blockquote></li><li><p>录制屏幕</p><blockquote><p>adb shell screenrecord /sdcard/filename.mp4</p></blockquote></li><li><p>查看设备是否解锁</p><blockquote><p>adb shell getprop ro.boot.flash.locked</p></blockquote></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> adb,技术,老谭 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>老房子的美</title>
      <link href="/2022/01/03/lao-fang-zi-de-mei/"/>
      <url>/2022/01/03/lao-fang-zi-de-mei/</url>
      
        <content type="html"><![CDATA[<p><img src="/2022/01/03/lao-fang-zi-de-mei/1.png"></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
